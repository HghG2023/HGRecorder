<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>事件详情编辑</title>
  <style>
    :root {
      --primary: #2b3a67;
      --secondary: #4a5ea4;
      --bg: #f7f9fc;
      --text: #333;
      --border: #d0d7e2;
    }

    body {
      background-color: var(--bg);
      font-family: 'Segoe UI', 'Helvetica Neue', sans-serif;
      color: var(--text);
      margin: 0;
      padding: 40px 20px;
      display: flex;
      justify-content: center;
    }

    .container {
      width: 100%;
      max-width: 800px;
      background: #fff;
      border-radius: 16px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.05);
      padding: 30px 40px;
    }

    h2 {
      color: var(--primary);
      border-left: 6px solid var(--secondary);
      padding-left: 12px;
    }

    form {
      margin-top: 20px;
    }

    .field {
      margin-bottom: 16px;
    }

    label {
      font-weight: 600;
      display: block;
      margin-bottom: 6px;
      color: var(--primary);
    }

    input, textarea, select {
      width: 100%;
      box-sizing: border-box;
      padding: 10px;
      border: 1px solid var(--border);
      border-radius: 8px;
      font-size: 15px;
      transition: border 0.2s ease;
    }

    input:focus, textarea:focus, select:focus {
      border-color: var(--secondary);
      outline: none;
      box-shadow: 0 0 0 2px rgba(74,94,164,0.15);
    }
    
    input[readonly] {
    background-color: #f2f4f8;
    color: #555;
    border-color: #ccc;
    cursor: not-allowed;
    }


    textarea {
      resize: vertical;
      min-height: 80px;
    }

    .actions {
      display: flex;
      gap: 10px;
      margin-top: 30px;
    }

    button {
      padding: 10px 24px;
      font-size: 15px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .save-btn {
      background-color: var(--secondary);
      color: white;
    }

    .save-btn:hover {
      background-color: var(--primary);
    }

    .back-btn {
      background-color: #e4e7ee;
      color: #333;
    }

    .back-btn:hover {
      background-color: #d0d4dc;
    }

    footer {
      margin-top: 40px;
      font-size: 13px;
      color: #999;
      text-align: center;
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>事件详情编辑</h2>
    <form id="eventForm">
 {% for key, value in event.items() %}
  <div class="field">
    <label>{{ key }}</label>

    {% if key in ["event_id", "file_original", "file_processed", "created_at"] %}
      {# 显示但不可编辑 #}
      <input type="text" name="{{ key }}" value="{{ value or '' }}" readonly>

    {% elif key == "done" %}
      <select name="{{ key }}">
        <option value="0" {% if value == 0 %}selected{% endif %}>未完成</option>
        <option value="1" {% if value == 1 %}selected{% endif %}>已完成</option>
      </select>

    {% elif key in ["importance", "confidence"] %}
      <input type="number" step="0.1" name="{{ key }}" value="{{ value or '' }}">

    {% elif key == "dates" %}
      <input type="date" name="{{ key }}" value="{{ value or '' }}">

    {% elif key == "times" %}
      <input type="time" name="{{ key }}" value="{{ value or '' }}">

    {% elif key in ["events", "tags"] %}
      <textarea name="{{ key }}">{{ value or '' }}</textarea>

    {% else %}
      <input type="text" name="{{ key }}" value="{{ value or '' }}">
    {% endif %}
  </div>
{% endfor %}


      <div class="actions">
        <button type="button" class="save-btn" onclick="saveEvent()">💾 保存修改</button>
        <button type="button" class="back-btn" onclick="window.location.href='/daily/'">⬅ 返回列表</button>
      </div>
    </form>

    <footer>
      HGRecorder 数据管理 · 事件 ID：{{ event['id'] | default('未指定') }}
    </footer>
  </div>
<script>
async function saveEvent() {
  const form = document.getElementById('eventForm');
  const formData = new FormData(form);
  const data = {};
  for (let [k, v] of formData.entries()) data[k] = v;

  const eventId = "{{ event['event_id'] | default('0') }}"; // Jinja 渲染
  const resp = await fetch(`/api/events/${eventId}`, {
    method: 'PUT',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(data)
  });

  if (resp.ok) { alert('更新成功'); window.location.href='/daily/'; }
  else { alert('更新失败'); }
}
</script>
</body>
</html>
